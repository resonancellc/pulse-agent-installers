#!/bin/bash

### Pulse account

echo
echo "#########################"
echo "1. CREATING PULSE ACCOUNT"
echo "#########################"
echo

# Create pulse user
adduser --system --group --home /var/lib/pulse2 --shell /bin/rbash --disabled-password pulseuser
if ! [ -d "/var/lib/pulse2/.ssh" ]; then
    echo "Create missing SSH profile ..."
    mkdir -p /var/lib/pulse2/.ssh
fi



### SSH Key

echo
echo "############"
echo "2. SETUP SSH"
echo "############"
echo

# Copy SSH keys
chown -R pulseuser: /var/lib/pulse2
chmod -R 700 /var/lib/pulse2
chmod 600 /var/lib/pulse2/.ssh/authorized_keys

# Open firewall port 22 - TODO
# if shorewall
# echo "ACCEPT net fw tcp 22" >> /etc/shorewall/rules
# service shorewall restart
#
# if ufw
# ufw enable
# sudo ufw allow 5900



### Setup VNC server

echo
echo "###################"
echo "3. SETUP VNC SERVER"
echo "###################"
echo

# Open firewall port 5900 - TODO
# if shorewall
# echo "ACCEPT net fw tcp 5900" >> /etc/shorewall/rules
# service shorewall restart
#
# if ufw
# ufw enable
# sudo ufw allow 5900


echo
echo "###################"
echo "3. SETUP SUDO for pulseuser"
echo "###################"
echo
echo "pulseuser ALL=(ALL) NOPASSWD: /usr/bin/rsync" > /etc/sudoers.d/pulseuser
